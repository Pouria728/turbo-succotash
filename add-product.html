<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ุงุถุงูู ฺฉุฑุฏู ูุญุตูู ุฌุฏุฏ</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <nav>
      <h1>ูุฑูุดฺฏุงู ุฎูุฏุฑููุง ุงุฑููพุง ฺฉูุงุณฺฉ</h1>
      <a href="index.html">๐ ุตูุญู ุงุตู</a>
      <a href="cart.html">๐ ุณุจุฏ ุฎุฑุฏ: <span id="cartCount">0</span></a>
    </nav>
  </header>

  <main>
    <h2>ุงุถุงูู ฺฉุฑุฏู ูุงุดู ุฌุฏุฏ</h2>
    <form id="addProductForm">
      <label for="name">ูุงู ูุงุดู:</label>
      <input type="text" id="name" required><br><br>

      <label for="price">ููุช (ุชููุงู):</label>
      <input type="number" id="price" required><br><br>

      <label for="image">ุชุตูุฑ ูุงุดู:</label>
      <input type="file" id="image" accept="image/*" required><br><br>

      <label for="desc">ุชูุถุญุงุช:</label>
      <textarea id="desc" required></textarea><br><br>

      <button type="submit">ุงุถุงูู ฺฉุฑุฏู ูุญุตูู</button>
    </form>
  </main>

  <footer>
    <p>&copy; 2026 ูุฑูุดฺฏุงู ุฎูุฏุฑููุง ฺฉูุงุณฺฉ. ุชูุงู ุญููู ูุญููุธ ุงุณุช.</p>
  </footer>

  <script src="products.js"></script>
  <script>
    // Update cart count
    function updateCartCount() {
      const cart = JSON.parse(localStorage.getItem("cart")) || [];
      const count = cart.reduce((sum, item) => sum + item.qty, 0);
      document.getElementById("cartCount").innerText = count;
    }
    updateCartCount();

    // Handle form submission
    document.getElementById("addProductForm").addEventListener("submit", function(e) {
      e.preventDefault();

      const name = document.getElementById("name").value;
      const price = parseInt(document.getElementById("price").value);
      const desc = document.getElementById("desc").value;
      const imageFile = document.getElementById("image").files[0];

      if (imageFile) {
        const reader = new FileReader();
        reader.onload = function(event) {
          const image = event.target.result; // base64

          // Get existing products from localStorage or default
          let products = JSON.parse(localStorage.getItem("products")) || [];
          if (products.length === 0) {
            // Load from products.js if not in localStorage
            products = window.products || [];
          }

          // Generate new ID
          const newId = products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1;

          // Add new product
          const newProduct = { id: newId, name, price, image, desc };
          products.push(newProduct);

          // Save to localStorage
          localStorage.setItem("products", JSON.stringify(products));

          alert("ูุญุตูู ุฌุฏุฏ ุงุถุงูู ุดุฏ!");
          // Redirect to index
          window.location.href = "index.html";
        };
        reader.readAsDataURL(imageFile);
      }
    });
  </script>
</body>
</html>